# 数据链路层的功能

数据链路层在物理层的基础上向网络层提供服务，最终目的是将来自网络层的数据安全可靠地传送到相邻节点的目标机网络层。它的原理是加强物理层传输的原始比特流，使之对网络层表现为无差错的链路，<font color=red>将物理层提供的可能出错的物理连接转换为不会出错的逻辑链接。</font>

# 封装成帧和透明传输

计算机网络中传输数据，数据是以帧为单位进行传输的。为了构建逻辑上不会出错的逻辑链路，数据链路层需要将数据进行封装成帧和透明传输两部分。

#### 封装成帧

数据链路层需要将数据打包成一个一个帧，打包过程非常简单，在数据的头部和尾部加上特殊的字节构成帧首部和帧尾部，就能起到帧定界的作用，告诉接收端在收到的比特流中从哪里到哪里是一个帧。

帧同步：接收方需要能够从接受的比特流中区分帧的起始和结束。

如下是几种常见的组帧方式：
- 字符计数法：帧首部使用一个字符（一字节，八位）说明这个帧有几个字节。

![[Pasted image 20241017082748.png]]

但是缺点显而易见，一旦出错问题严重。

- 字符填充法：在数据的前后分别加上一段特定的字节，表示一个帧的起始和结尾。

![[Pasted image 20241017083057.png]]

但是中间传输的内容如果也有和SOH与EOT相同的字节段，可能会导致接收端错误地找到了接受边界，这时候需要对数据内容中的字节段进行填充才能达到透明传输。

具体做法是，在所有与特殊字符相撞的数据段字符前加上转义字符，对接收端声明我之后的内容无需进行操作，按正常传输即可。

![[Pasted image 20241017083507.png]]

- 零比特填充法：这种方法识别的SOH和EOT是F，就是6个连续的1.为了防止传送的数据内容出现六个连续的1，从而导致接收端错误认为数据的起始和结尾，在传送的数据内容中每隔五个1就加入一个0.接收端接受到比特流之后识别出每个帧，然后在帧的数据内容中对连续的五个一后面删个0就得到了原始比特流。

![[Pasted image 20241017084339.png]]

- 违规编码法：例如在曼彻斯特编码中，由于单位时间内的信号一定会发生跳变，因此不可能出现高高-低低两种形式。我们可以用这两种信号表示帧的起始与结束。

![[Pasted image 20241017084551.png]]


#### 透明传输

数据链路层需要确保在传输过程中无论需要传输的数据是什么都不会影响传送，也就是数据内容中的任何片段都不会被接收端错误识别为某种控制信息。


# 差错控制

#### 几种差错

差错主要有这几种：
- 随机噪声（热噪声）：线路本身特性所造成的噪声，可以通过提高信噪比降低影响。
- 冲击噪声：因为外部短暂原因造成的噪声，可以通过编码技术解决。
具体地，差错有这几种情况：
- 位错：单个比特位发生差错，1变成0,0变成1
- 帧错：有丢失重复失序三种。

![[Pasted image 20241017085639.png]]

现代针对网络链接质量不同推出了不同的数据链路层服务协议，针对网络连接质量好的，可以不进行冗余的重发确认，采用无确认无连接协议。其他的视情况而定。

![[Pasted image 20241017085734.png]]

#### 检查并纠正比特错的方式

检查方式基本都是向原有的信息中加入冗余的数据位，接受方收到带着冗余位的数据之后按照与发送方约定好的方式检查数据，从而判断传送有无出错。

奇偶校验码：和名字一样，检测传送过来的信息中1的个数是偶数还是奇数，从而判断有无出错，检错能力弱。

循环冗余码（CRC）：对于一个待传数据，首先分成d组，然后规定我们要给每一个组加上r位FCS冗余码。这个r位FCS冗余码生成规则如下：

>1. 给这d位数据后面添r位0
>2. 除以规定的生成多项式（一般给出的是一个r+1位多项式）
>3. 得到余数即为要添加的r位FCS。

接收方检验获得的带冗余码的d+r位数据，除以这个生成多项式。如果余数为0则没有问题，接受；反之出现错误。

![[Pasted image 20241017105324.png]]


![[Pasted image 20241017105617.png]]


除了检错之外，还有纠正错误的方法。我们介绍海明码。

海明码一言以蔽之，就是向原有的数据中加入几位额外的数字，每个数字分别与数据中的几位共同满足偶校验（例如，四号位的数字和数据中的第五六七号三个数字一起满足偶校验）。接着在收到信息之后使用加入的这几个额外的数字判断是否满足偶校验。满足就正常，不满足可以通过一些手段发现是哪一位出现了错误，从而改正。

具体流程如下：

- 确定海明码位数。对于有m位的数据，冗余位应该有r位，r的值这样确定：满足式子$$2^r\ge m+r+1$$的最小r值。
- 确定冗余码的位置。对于先前求出的r，我们确定了要加入一共r个冗余码，那么我们分别使得每个冗余码放在$2^n$的位置上。例如第1个冗余码放在$2^0$,第二个放在$2^1$上，其余类推。剩下的空位按照低对低高对高塞入数据。例如：
![[Pasted image 20241018084421.png]]

- 求出校验码的值。我们由上可以知道每个冗余码的位置对应的数字肯定只有一个'1'，例如$x_4$在100，对应1**,那么我们现在令每个冗余位的数字和其他满足对应位为1的数据位的数字共同满足偶校验（即1的数字总数为偶数），例如$x_4$要和所有满足1** 形式的数字，也就是5 6 7位满足偶校验，以此类推即可得到几个冗余码的数值。
- 纠错。接收方现在收到了和冗余码一起传过来的数据信息。现在判断是否出错。对几位冗余码分别进行偶校验，如果全部满足则没有问题。反之则需要纠错。两种方法，画韦恩图或者进行异或转置。
![[Pasted image 20241018084847.png]]


# 流量控制和可靠传输机制

数据链路层传输数据的过程中必须要发送方和接收方满足一定速度要求，才能不浪费性能或者造成拥堵。

#### 流量控制的方法

- 停止-等待协议：发送方每发出一个信息，接收方如果收到则返回一个确认帧，发送方收到确认才会继续发送。

![[Pasted image 20241018085949.png]]

- 